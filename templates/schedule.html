{% extends "base.html" %}

{% block content %}
<div class="schedule-container">
    <div class="schedule-card">
        <h2 class="schedule-title">Schedule a Session</h2>
        
        <!-- Flash Messages -->
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                <div class="flash-messages">
                    {% for category, message in messages %}
                        <div class="alert alert-{{ category }}">{{ message }}</div>
                    {% endfor %}
                </div>
            {% endif %}
        {% endwith %}
        
        <form method="POST" class="schedule-form">
            <!-- Trainer Selection -->
            <div class="form-group">
                <label for="trainer_id" class="form-label">
                    <i class="fas fa-user-tie"></i> Select Trainer
                </label>
                <select class="form-control" id="trainer_id" name="trainer_id" required>
                    <option value="">-- Choose a Trainer --</option>
                    {% for trainer in trainers %}
                        <option value="{{ trainer[0] }}">{{ trainer[1] }} - {{ trainer[2] }}</option>
                    {% endfor %}
                </select>
            </div>
            
            <!-- Date Picker -->
            <div class="form-group">
                <label for="session_date" class="form-label">
                    <i class="far fa-calendar-alt"></i> Session Date
                </label>
                <input type="date" class="form-control" id="session_date" 
                       name="session_date" 
                       min="{{ min_date }}"
                       value="{{ min_date }}"
                       required>
                <small class="form-hint">Format: YYYY-MM-DD</small>
            </div>
            
            <!-- Time Selection -->
            <div class="time-selection">
                <div class="time-group">
                    <label for="start_time" class="form-label">
                        <i class="far fa-clock"></i> Start Time
                    </label>
                    <input type="time" class="form-control" id="start_time" 
                           name="start_time" 
                           min="06:00" 
                           max="20:00" 
                           step="900"  <!-- 15 minute increments -->
                           required>
                </div>
                
                <div class="time-group">
                    <label for="end_time" class="form-label">
                        <i class="far fa-clock"></i> End Time
                    </label>
                    <input type="time" class="form-control" id="end_time" 
                           name="end_time" 
                           min="06:00" 
                           max="20:00" 
                           step="900"
                           required>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="form-actions">
                <button type="submit" class="btn btn-primary">
                    <i class="fas fa-calendar-check"></i> Book Session
                </button>
                <a href="{{ url_for('dashboard') }}" class="btn btn-secondary">
                    <i class="fas fa-times"></i> Cancel
                </a>
            </div>
        </form>
    </div>
</div>

<style>
.schedule-container {
    max-width: 800px;
    margin: 2rem auto;
    padding: 0 1rem;
}

.schedule-card {
    background: white;
    border-radius: 10px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    padding: 2rem;
}

.schedule-title {
    color: #2c3e50;
    text-align: center;
    margin-bottom: 1.5rem;
    font-weight: 600;
}

.schedule-form {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

.form-group {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
}

.form-label {
    font-weight: 500;
    color: #34495e;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.form-control {
    padding: 0.75rem;
    border: 1px solid #ddd;
    border-radius: 5px;
    font-size: 1rem;
}

.time-selection {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 1rem;
}

.form-hint {
    color: #7f8c8d;
    font-size: 0.8rem;
}

.form-actions {
    display: flex;
    gap: 1rem;
    margin-top: 1rem;
}

.btn {
    padding: 0.75rem 1.5rem;
    border: none;
    border-radius: 5px;
    font-weight: 500;
    cursor: pointer;
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    transition: all 0.2s;
}

.btn-primary {
    background: #3498db;
    color: white;
}

.btn-primary:hover {
    background: #2980b9;
}

.btn-secondary {
    background: #95a5a6;
    color: white;
}

.btn-secondary:hover {
    background: #7f8c8d;
}

.alert {
    padding: 1rem;
    border-radius: 5px;
    margin-bottom: 1rem;
}

.alert-danger {
    background: #f8d7da;
    color: #721c24;
}

.alert-success {
    background: #d4edda;
    color: #155724;
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const form = document.querySelector('.schedule-form');
    const dateInput = document.getElementById('session_date');
    const startInput = document.getElementById('start_time');
    const endInput = document.getElementById('end_time');
    
    // Set minimum time based on selected date
    dateInput.addEventListener('change', function() {
        const today = new Date().toISOString().split('T')[0];
        const isToday = this.value === today;
        
        if (isToday) {
            const now = new Date();
            const currentHour = now.getHours().toString().padStart(2, '0');
            const currentMinute = Math.ceil(now.getMinutes() / 15) * 15;
            const roundedMinutes = currentMinute.toString().padStart(2, '0');
            
            startInput.min = `${currentHour}:${roundedMinutes}`;
        } else {
            startInput.min = '06:00';
        }
    });
    
    // Validate form before submission
    form.addEventListener('submit', function(e) {
        const start = startInput.value;
        const end = endInput.value;
        
        if (start >= end) {
            alert('Error: End time must be after start time');
            e.preventDefault();
            return;
        }
        
        const duration = (parseInt(end.split(':')[0]) * 60 + parseInt(end.split(':')[1])) - 
                         (parseInt(start.split(':')[0]) * 60 + parseInt(start.split(':')[1]));
        
        if (duration < 30) {
            alert('Error: Minimum session duration is 30 minutes');
            e.preventDefault();
        }
    });
});
</script>
{% endblock %}